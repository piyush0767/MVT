<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Milk Van Tracking</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .hidden { display: none; }
    .toast { position: fixed; top: 10px; right: 10px; background: #444; color: #fff; padding: 10px; border-radius: 5px; z-index: 9999; }
    button { margin: 5px; }
  </style>
</head>
<body>
  <h2 id="title">Milk Van Tracking</h2>

  <!-- Language toggle -->
  <button onclick="toggleLanguage()">üåê Switch Language</button>

  <!-- Driver Login Section -->
  <div id="driverLoginSection">
    <h3 id="driverLoginTitle">Driver Login</h3>
    <input id="routeNumber" placeholder="Enter Route Number" /><br/>
    <input id="password" type="password" placeholder="Enter Password" /><br/>
    <select id="shiftSelector">
      <option value="Morning">Morning</option>
      <option value="Evening">Evening</option>
    </select><br/>
    <button onclick="driverLogin()">Login</button>
  </div>

  <!-- Driver Section -->
  <div class="driver-section hidden">
    <h3 id="driverHeader">Welcome Driver</h3>
    <p><strong>Route:</strong> <span id="driverRoute"></span></p>
    <p><strong id="shiftLabel">Shift:</strong> <span id="shiftDisplay"></span></p>
    <p><strong>Login Time:</strong> <span id="loginTime"></span></p>

    <ul id="societyList"></ul>
  </div>

  <!-- Toast Message Container -->
  <div id="toast" class="toast hidden"></div>

  <script>
    // Show toast
    function showToast(msg) {
      const toast = document.getElementById("toast");
      toast.innerText = msg;
      toast.classList.remove("hidden");
      setTimeout(() => toast.classList.add("hidden"), 3000);
    }

    // Load route data if not in localStorage
    function initRouteData() {
      if (!localStorage.getItem("routeData")) {
        const sampleData = {
          "1801": {
            password: "Milk1801",
            societies: {
              Morning: ["Shivaji Nagar", "Green Valley", "Sai Residency"],
              Evening: ["Shivaji Nagar", "Green Valley", "Evening Heights"]
            }
          },
          "1802": {
            password: "Milk1802",
            societies: {
              Morning: ["Lakeview Apartments", "Sunrise Colony"],
              Evening: ["Sunset Residency", "Twilight Homes"]
            }
          }
        };
        localStorage.setItem("routeData", JSON.stringify(sampleData));
        alert("‚úÖ Sample data loaded!\nTry route 1801 & password Milk1801");
      }
    }

    // Load saved language
    function loadLanguage() {
      const lang = localStorage.getItem("lang") || "en";
      applyLanguage(lang);
    }

    function toggleLanguage() {
      const current = localStorage.getItem("lang") || "en";
      const next = current === "en" ? "hi" : "en";
      applyLanguage(next);
      localStorage.setItem("lang", next);
    }

    function applyLanguage(lang) {
      const texts = {
        en: {
          title: "Milk Van Tracking",
          driverLoginTitle: "Driver Login",
          driverHeader: "Welcome Driver",
          shiftLabel: "Shift:"
        },
        hi: {
          title: "‡§¶‡•Ç‡§ß ‡§µ‡§æ‡§π‡§® ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó",
          driverLoginTitle: "‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞ ‡§≤‡•â‡§ó‡§ø‡§®",
          driverHeader: "‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞",
          shiftLabel: "‡§∂‡§ø‡§´‡•ç‡§ü:"
        }
      };
      const t = texts[lang];
      document.getElementById("title").innerText = t.title;
      document.getElementById("driverLoginTitle").innerText = t.driverLoginTitle;
      document.getElementById("driverHeader").innerText = t.driverHeader;
      document.getElementById("shiftLabel").innerText = t.shiftLabel;
    }

    function driverLogin() {
      const route = document.getElementById("routeNumber").value.trim();
      const password = document.getElementById("password").value;
      const shift = document.getElementById("shiftSelector").value;

      const routeData = JSON.parse(localStorage.getItem("routeData"));

      if (!routeData[route]) {
        showToast("‚ùå Route not found");
        return;
      }

      if (routeData[route].password !== password) {
        showToast("‚ùå Incorrect password");
        return;
      }

      // Show driver section
      document.querySelector(".driver-section").classList.remove("hidden");
      document.getElementById("driverRoute").innerText = route;
      document.getElementById("shiftDisplay").innerText = shift;
      document.getElementById("loginTime").innerText = new Date().toLocaleTimeString();
      document.getElementById("driverLoginSection").classList.add("hidden");

      showSocietyList(route, shift);
    }

    function showSocietyList(route, shift) {
      const routeData = JSON.parse(localStorage.getItem("routeData"));
      const societies = routeData[route].societies[shift] || [];
      const ul = document.getElementById("societyList");
      ul.innerHTML = "";

      societies.forEach((name, index) => {
        const li = document.createElement("li");
        li.innerHTML = `
          ${name}
          <button onclick="mark('${name}', 'arrival')">Arrival</button>
          <button onclick="mark('${name}', 'dispatch')">Dispatch</button>
        `;
        ul.appendChild(li);
      });
    }

    function mark(society, action) {
      showToast(`‚úîÔ∏è ${society} marked as ${action}`);
    }

    // On load
    document.addEventListener("DOMContentLoaded", () => {
      initRouteData();
      loadLanguage();
    });
  </script>
  <script src="script.js"></script>
</body>
</html>
